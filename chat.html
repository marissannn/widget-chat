<div id="chatbox"></div>

<script>
  const chatbox = document.getElementById("chatbox");

  // Función para agregar los mensajes al chatbox
  function addMessage(username, message) {
    let msgElement = document.createElement("p");
    msgElement.innerHTML = `<strong>${username}:</strong> ${message}`;
    chatbox.appendChild(msgElement);
    chatbox.scrollTop = chatbox.scrollHeight;
  }

  // Conectar a WebSocket de Twitch (IRC)
  const ws = new WebSocket("wss://irc.chat.twitch.tv:443");

  // Evento cuando la conexión está abierta
  ws.onopen = () => {
    console.log("Conexión establecida con el chat de Twitch.");  // Aquí se confirma la conexión
    ws.send("PASS oauth:sajxncx1ku90smi0qcul6iapyhwztr");  // Tu OAuth Token
    ws.send("NICK marissan__");  // Tu nombre de usuario
    ws.send("JOIN #Marissan__");  // Nombre de tu canal
  };

  // Evento cuando se recibe un mensaje
  ws.onmessage = (event) => {
    console.log("Mensaje recibido:", event.data);  // Aquí se muestra el mensaje recibido
    let message = event.data;

    // Expresión regular para extraer el nombre de usuario y el mensaje
    let match = message.match(/:(\w+)!\w+@\w+\.tmi\.twitch\.tv PRIVMSG #\w+ :(.*)/);
    if (match) {
      addMessage(match[1], match[2]);  // Muestra el mensaje en el chatbox
    }
  };

  // Si hay algún error en la conexión
  ws.onerror = (error) => {
    console.error("Error en WebSocket:", error);  // Aquí se muestra el error
    alert('Error en la conexión WebSocket: ' + error);  // Muestra un mensaje de alerta con el error
  };

  // Si la conexión se cierra
  ws.onclose = () => {
    console.log("Conexión cerrada.");  // Aquí se muestra cuando la conexión se cierre
  };
</script>

<style>
  #chatbox {
    width: 300px;
    height: 500px;
    background: rgba(0, 0, 0, 0.5);
    color: white;
    font-size: 14px;
    padding: 10px;
    overflow-y: auto;
    border-radius: 10px;
    border: 1px solid white;  /* Asegúrate de que el borde esté visible */
    margin-top: 20px; /* Para darle algo de espacio */
  }
</style>

